<?php $this->headTitle($this->escape($this->document->title)); ?>

<div class="document">
    <div class="document-top">
        <div class="label-left">
            <?php if(intval($this->escape($this->document->public))) : ?>
            <span class="label label-info">Publié</span>
            <?php endif; ?>
        </div>
        <div class="document-show-date">
            Ajouté le <?php echo $this->escape($this->document->date); ?>
        </div>
        <div class="backtolist">
            <a href="<?php echo $this->url(array(
                                        'username' => $this->escape($this->username)
                                          ), 'userLibrary'); ?>">
            Retour à la bibliothèque
            </a>
        </div>
    </div>
    
        <div class="document-show-header">
            <h3><?php echo $this->escape($this->document->title);?></h3>
        </div>
    <table>
        <tr>
            <td>
                <div class="document-show-vote">
                    <div class="vote-d">
                        <input type="hidden" value="<?php echo $this->escape($this->document->id); ?>" />
                        <?php echo $this->documentVote($this->escape($this->document->id), 'DOWN_DOCUMENT'); ?>
                        <span class="vote-value"><?php echo $this->escape($this->document->vote); ?></span>
                        <?php echo $this->documentVote($this->escape($this->document->id), 'UP_DOCUMENT'); ?>
                    </div>
                </div>
            </td>
            <td>
                <div class="document-show-description">
                    <?php echo $this->purify($this->document->content);?> 
                </div>
            </td>
        </tr>
    </table>
    
    <div class="document-show-source">
        <?php if($this->escape($this->document->source) != null && $this->escape($this->document->source) != '') : ?>
        Source : <?php echo $this->escape($this->document->source);?> 
        <?php endif; ?>
    </div>
    <div class="tags2">
        <?php
        foreach($this->tags as $tag) : ?>
        <div class="tag">
            <div class="tag-name">
                <a href="<?php echo $this->url(array(
                                    'name'=> $this->escape($tag->name)
                                ), 'taggedTopic'); ?>"><?php echo $this->escape($tag->name); ?></a>
            </div>  
            <div class="tag-action">
                <?php echo $this->favoriteTag($this->escape($tag->tagId), $this->escape($tag->name)); ?>
            </div>
        </div>
        <?php endforeach; ?>
        <?php if($this->escape($this->document->lastEditDate) != null) : ?>
        <div class="document-show-date">
            Edité le <?php echo $this->escape($this->document->lastEditDate); ?>
        </div>
        <?php endif; ?>
    </div>
    <div class="document-show-menu">
        <div class="btn-left">
            <a class="btn btn-small btn-warning alert-document-link" 
               title="Alerter un modérateur sur le contenu du document"
               id="document-<?php echo $this->escape($this->document->id); ?>" href="<?php echo $this->url(array(
                                                    'module' => 'default',
                                                    'controller' => 'library',
                                                    'action' => 'alert',
                                                    'id'=> $this->escape($this->document->id)
                                            ), 'default', true); ?>">Signaler
            </a>
            <?php if($this->escape($this->author)) : ?>
            <a class="btn btn-small" href="<?php echo $this->url(array(
                                                    'id'=> $this->escape($this->document->id)
                                            ), 'editDocument', true); ?>">Editer
            </a>
            <?php endif; ?>
        </div>
        <?php if($this->escape($this->author)) : ?>
        <div class="btn-right">
            <a id="delete-document-link-<?php echo $this->escape($this->document->id).'-show'; ?>" 
               class="btn btn-danger btn-small" 
               href="<?php echo $this->url(array(
                                            'id'=> $this->escape($this->document->id)
                                            ), 'deleteDocument', true); ?>">Supprimer
            </a>
        </div>
        <?php endif; ?>
    </div>
</div>

<?php if($this->escape($this->author)) : ?>
<div id="dialog-delete-document" title="Supprimer un document" style="display:none;">
    Voulez-vous vraiment supprimer ce document ?
</div>
<?php endif; ?>

<div id="dialog-alert-document" title="Signaler ce document" style="display:none;">
    <?php echo $this->form; ?>
</div>